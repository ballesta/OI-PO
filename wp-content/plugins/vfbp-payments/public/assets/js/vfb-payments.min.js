!function(e,t,$){"use strict";var i,r=function(){this.entry="",this.decimals=2,this.basePrice=0,this.basePriceText="",this.currency="",this.totalText="",this.publicForm="",this.priceFields=[],this.tmpl='<table id="run" border="0" cellspacing="0" cellpadding="0"><tfoot>{rows}</tfoot><tbody><tr><td colspan="2"><b>{totalText}</b><span>{total}</span></td></tr></tbody></table>',this.init(),this.showRunningTotal()&&(this.organizePriceFields(this.priceFields),this.updateTotal(),this.calculateTop(),this.runScroll(),$(e).on("scroll",this.runScroll))};r.prototype={init:function(){var t=this;if(e.vfbp_prices){var i=$.parseJSON(vfbp_prices.prices),r=[],n=[];$(i).each(function(){var e=this.currency,i=this.decimals,l=this["total-text"],a=this["base-price-name"],c=this["base-price"],s=this["price-fields"];t.currency=e,t.decimals=i,t.totalText=l,t.basePriceText=a,t.basePrice=t.toNumber(c),t.priceFields=s,$.each(s,function(){r.push("[name^=vfb-field-"+this["field-id"]+"]"),"currency"===this.type&&n.push("[name^=vfb-field-"+this["field-id"]+"]")}),$(r.join(",")).change(function(){t.updateTotal()}),$(n.join(",")).keyup(function(){t.updateTotal()})})}},showRunningTotal:function(){var e=!1;return $("#vfbp-running-total").length&&(e=!0),e},calculateTop:function(){var e=t.getElementById("vfbp-running-total");i=-75,e&&(i+=$(e).offset().top,e=e.offsetParent)},runScroll:function(){var r=e.pageYOffset||t.documentElement.scrollTop||t.body.scrollTop,n=$("#vfbp-running-total");r>=i&&n.length?n.css("margin-top",r-i+7):n.css("margin-top",7)},organizePriceFields:function(e){this.priceFields=[];var t=this;$.each(e,function(e,i){var r=i.type;if("checkbox"===String(r))$.each(i,function(e,r){"object"==typeof r&&t.addToPriceFields(i,r,e)});else if("radio"===String(r)||"select"===String(r)){var n=t.getTextToIndexs(i);$.each(i,function(e,r){if("object"==typeof r){var l=n[r.choice];t.addToPriceFields(i,r,l)}})}else"currency"===String(r)&&(i.price="1",t.addToPriceFields(i,null,0))})},addToPriceFields:function(e,t,i){var r={},n="currency"===String(e.type)?e:t;r.FieldID=e["field-id"],r.Price=n.price,r.Choice=n.choice,r.Type=e.type,r.Index=i,r.Header="currency"===String(e.type)?n.title:n.choice,this.priceFields.push(r)},getTextToIndexs:function(e){var t=0,i=e["field-id"],r=[];return $.each(e,function(){var e=$("#vfb-field-"+i+"-"+t);e.length&&(r[e.val()]=t),t+=1}),r},updateTotal:function(){var e=$("#vfbp-running-total");if(e.length){var t=this.getFieldToPrices(),i=this.buildRunningTotalTable(t);e.html(i)}},buildRunningTotalTable:function(e){var t="",i=this.basePrice;this.basePrice>0&&(t+="<tr><th>"+this.basePriceText+"</th>",t+="<td>"+this.formatNumber(this.basePrice)+"</td></tr>");for(var r=0;r<e.length;r++){var n=e[r];i+=n.fieldValue;var l=n.fieldValue<0?"vfb-negative-amount":"";t+='<tr class="'+l+'"><th>'+n.field.Header+"</th>",t+="<td>"+this.formatNumber(n.fieldValue)+"</td></tr>"}var a={totalText:this.totalText,total:this.formatNumber(i),rows:t};return this.template(a)},getFieldToPrices:function(){for(var e=[],t,i,r=0;r<this.priceFields.length;r++)t=this.getFieldValue(this.priceFields[r]),t="currency"===String(this.priceFields[r].type)&&0>t?0:t,(t>0||0>t)&&(i={fieldValue:t,field:this.priceFields[r]},e.push(i));return e},getFieldValue:function(e){var t=0,i=this.getElement(e),r=String(e.Type);return i?this.isElementHidden(i)||(t=this.getElementValue(e,i)):"currency"===r?t=this.entry[e.FieldID]:"checkbox"===r?"undefined"!=typeof this.entry[e.FieldID]&&""!==this.entry[e.FieldID]&&(t=e.Price):("radio"===r||"select"===r)&&e.Choice===this.entry[e.FieldID]&&(t=e.Price),this.toNumber(t)},getElement:function(e){return"checkbox"===String(e.Type)||"radio"===String(e.Type)?$("#vfb-field-"+e.FieldID+"-"+e.Index)[0]:$("#vfb-field-"+e.FieldID)[0]},getElementValue:function(e,t){if("checkbox"===String(e.Type)||"radio"===String(e.Type))return t.checked?e.Price:0;if("select"===String(e.Type))return e.Choice===t.value?e.Price:0;if("currency"===String(e.Type)){var i=$("#vfb-field-"+e.FieldID),r=i.val().replace(/[^0-9\.]/g,"");return String(r)}},isElementHidden:function(e){var t=!1,i=this.getFieldEl(e);return this.hasHiddenClassName(i)&&(t=!0),t},hasHiddenClassName:function(e){var t=$(e);return t.hasClass("vfb-rule-hide")?!0:void 0},getFieldEl:function(e){var t=$(e);return t=t.length?t:$(e),t[0]},formatNumber:function(e){var t=0>e?!0:!1;return e=Math.abs(e),e=e.toFixed(this.decimals),e=this.addCommas(e),e=this.currency+e,e=t?"-"+e:e},addCommas:function(e){e+="";for(var t=e.split("."),i=t[0],r=t.length>1?"."+t[1]:"",n=/(\d+)(\d{3})/;n.test(i);)i=i.replace(n,"$1,$2");return i+r},toNumber:function(e){"undefined"==typeof e&&(e="0");var t=Number(e);return t=isNaN(t)?0:t},template:function(e){var t=this.tmpl.replace(/\{totalText\}/g,e.totalText).replace(/\{total\}/g,e.total).replace(/\{rows\}/g,e.rows);return t}},e.VFBProRunningTotal=new r}(window,document,jQuery);